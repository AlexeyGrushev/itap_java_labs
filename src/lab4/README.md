# lab4

Набор примеров на Java для лабораторной работы 4 — демонстрация механизмов обработки исключений, создание собственных классов исключений и логирование ошибок.

## Содержимое

- `Main.java` — главный класс с интерактивным меню для запуска всех заданий.
- `Task1.java` — вычисление среднего арифметического массива с обработкой исключений (выход за границы, неверный формат).
- `Task2.java` — копирование файлов с обработкой исключений открытия/закрытия и чтения/записи.
- `Task3_Variant6.java` — проверка ввода целого числа с использованием собственного исключения (Вариант 6).
- `CustomInputMismatchException.java` — пользовательский класс исключения для валидации ввода.
- `ExceptionLogger.java` — утилита для логирования всех исключений в текстовый файл с временными метками.

## Структура проекта

```
lab4/
├── Main.java                           # Главный файл запуска
├── Task1.java                          # Задание 1: среднее арифметическое
├── Task2.java                          # Задание 2: копирование файлов
├── Task3_Variant6.java                 # Задание 3: проверка ввода (вариант 6)
├── CustomInputMismatchException.java   # Собственное исключение
├── ExceptionLogger.java                # Логгер исключений
└── README.md                           # Этот файл
```

## Требования

- Установленная JDK (рекомендуется Java 8 или выше).
- Доступ к терминалу/командной строке.

## Сборка и запуск из командной строки

### Вариант 1: Прямая компиляция и запуск

1. Находясь в папке `lab4`, скомпилируйте все исходники:

```bash
javac *.java
```

2. Запустите главную программу:

```bash
java Main
```

### Вариант 2: С использованием отдельной папки для скомпилированных файлов

1. Создайте папку для скомпилированных файлов:

```bash
mkdir -p bin
```

2. Скомпилируйте исходники:

```bash
javac -d bin *.java
```

3. Запустите программу:

```bash
java -cp bin Main
```

### Вариант 3: Запуск отдельных заданий

Можно запускать задания по отдельности:

```bash
# Задание 1
java Task1

# Задание 2
java Task2

# Задание 3 (вариант 6)
java Task3_Variant6
```

## Использование программы

После запуска `Main.java` появится интерактивное меню:

```
╔═══════════════════════════════════════════════════════╗
║   Лабораторная работа №4: Обработка исключений        ║
╚═══════════════════════════════════════════════════════╝

╔═══════════════════════════════════════════════════════╗
║                    ГЛАВНОЕ МЕНЮ                       ║
╠═══════════════════════════════════════════════════════╣
║  1. Задание 1 - Среднее арифметическое массива        ║
║  2. Задание 2 - Копирование файлов                    ║
║  3. Задание 3 (Вариант 6) - Проверка ввода числа      ║
║  4. Выход                                             ║
╚═══════════════════════════════════════════════════════╝
```

### Пункт 1: Среднее арифметическое массива

Демонстрирует:
- Корректное вычисление среднего арифметического элементов массива `{1, 2, 3, 4, 5}`
- Обработку `ArrayIndexOutOfBoundsException` при выходе за границы массива
- Обработку `NumberFormatException` для неверных данных
- Восстановление после ошибки и вычисление корректного результата

### Пункт 2: Копирование файлов

Демонстрирует два варианта:

**Вариант 1:** Обработка ошибок открытия и закрытия файлов
- Использование блока `finally` для гарантированного закрытия потоков
- Обработка `FileNotFoundException` и `IOException`

**Вариант 2:** Обработка ошибок чтения и записи файлов
- Использование конструкции `try-with-resources`
- Раздельная обработка ошибок чтения и записи

Программа автоматически создаёт тестовый файл `source.txt` и копирует его в:
- `destination.txt` (вариант 1)
- `destination.txt.v2` (вариант 2)

### Пункт 3: Проверка ввода целого числа (Вариант 6)

Демонстрирует:
- Интерактивный ввод целого числа с клавиатуры
- Валидацию ввода с помощью собственного исключения `CustomInputMismatchException`
- Автоматическое тестирование различных случаев:
  - Корректное число: `123`
  - Буквы: `abc`
  - Дробное число: `12.5`
  - Пустая строка
  - Число с пробелами: `  456  `
  - Слишком большое число: `999999999999999999`
- Логирование всех исключений в файл `exceptions.log`

## Ожидаемый вывод

### Задание 1
```
Ошибка: выход за границы массива!
Сообщение исключения: Index 5 out of bounds for length 5
Корректное среднее арифметическое: 3.0

Содержимое массива:
1 2 3 4 5
```

### Задание 2
```
Исходный файл source.txt создан.

=== Вариант 1: Обработка открытия/закрытия файлов ===
Файл успешно скопирован из source.txt в destination.txt
Входной поток закрыт
Выходной поток закрыт

=== Вариант 2: Обработка чтения/записи файлов ===
Файл успешно скопирован из source.txt в destination.txt.v2
```

### Задание 3
```
Введите целое число:
abc

❌ CustomInputMismatchException: Введенное значение не является целым числом! (введено: 'abc')
Исключение записано в лог-файл: exceptions.log

Демонстрация различных случаев:
Тест ввода: "123"
✓ Результат: 123

Тест ввода: "abc"
✗ Введенное значение не является целым числом!
...
```

## Сгенерированные файлы

После выполнения программы будут созданы следующие файлы:

- `source.txt` — исходный тестовый файл для копирования
- `destination.txt` — результат копирования (вариант 1)
- `destination.txt.v2` — результат копирования (вариант 2)
- `exceptions.log` — лог всех возникших исключений с временными метками и stack trace
- `*.class` — скомпилированные Java-классы

## Формат лога исключений

Файл `exceptions.log` содержит подробную информацию о каждом исключении:

```
============================================================
Время: 2025-10-30 14:23:45
Тип исключения: CustomInputMismatchException
Сообщение: Введенное значение не является целым числом!
Дополнительная информация: Пользователь ввел некорректные данные
Stack trace:
CustomInputMismatchException: Введенное значение не является целым числом!
    at Task3_Variant6.readInteger(Task3_Variant6.java:42)
    at Task3_Variant6.main(Task3_Variant6.java:12)
...
```

## Примечания

- Все исключения автоматически логируются в файл `exceptions.log` с помощью класса `ExceptionLogger`.
- Блок `finally` гарантирует выполнение кода очистки даже при возникновении исключений.
- Конструкция `try-with-resources` автоматически закрывает ресурсы (файлы, потоки).
- Собственные исключения наследуются от класса `Exception` и могут содержать дополнительную информацию.
- В Задании 1 специально создаётся ошибка выхода за границы массива для демонстрации обработки исключений.

## Отладка и тестирование

### Проверка работы отдельных компонентов:

```bash
# Тестирование логгера
java ExceptionLogger

# Тестирование собственного исключения
java CustomInputMismatchException

# Запуск отдельного задания
java Task1
java Task2
java Task3_Variant6
```

### Очистка скомпилированных файлов:

```bash
# Удаление .class файлов
rm *.class

# Удаление сгенерированных файлов
rm source.txt destination.txt destination.txt.v2 exceptions.log
```

## Возможные ошибки и решения

| Ошибка | Причина | Решение |
|--------|---------|---------|
| `Error: Could not find or load main class Main` | Не скомпилированы файлы | Выполните `javac *.java` |
| `cannot find symbol` | Отсутствует один из файлов | Убедитесь, что все 6 файлов в папке `lab4` |
| `Access denied` при создании файлов | Нет прав на запись | Проверьте права доступа к папке |
| Кракозябры в консоли | Проблема с кодировкой | Используйте `-encoding UTF-8` при компиляции |

## Дополнительные возможности

Если нужно:
- **Unit-тесты:** можно добавить JUnit тесты для проверки корректности обработки исключений
- **Javadoc:** можно сгенерировать документацию командой `javadoc -d docs *.java`
- **Расширенное логирование:** можно добавить уровни логирования (INFO, WARNING, ERROR)
- **Конфигурация:** можно вынести имена файлов в конфигурационный файл

## Контрольные вопросы (из лабораторной работы)

1. Что такое исключение в Java?
2. Какие ключевые классы исключений вы знаете?
3. Что такое проверяемые и непроверяемые исключения?
4. Какие исключения и как необходимо обрабатывать?
5. Какие исключения относятся к классу Error и как их обрабатывать?
6. Какие исключения относятся к классу RuntimeException и как их обрабатывать?
7. Как создать собственный класс исключения?
8. Как обрабатываются исключения в Java? Какие конструкции для этого используются?
9. Можно ли использовать try без catch или finally?
10. Что произойдет, если исключение возникнет в блоке finally?
11. Как можно пробросить исключение выше по стеку вызовов?
12. В чем разница между finally и try-with-resources?
